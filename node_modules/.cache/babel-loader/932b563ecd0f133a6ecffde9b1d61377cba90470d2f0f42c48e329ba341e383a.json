{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Link}from\"react-router-dom\";import axios from\"axios\";import dayjs from\"dayjs\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Profile=()=>{const[items,setItems]=useState([]);const[drivers,setDrivers]=useState([]);const[selectedDriver,setSelectedDriver]=useState(\"\");const[filteredOrders,setFilteredOrders]=useState([]);const[user,setUser]=useState(null);const apiUrl=\"https://bam-app-489c6c1370a9.herokuapp.com\";// Получение всех данных с сервера\nuseEffect(()=>{const fetchData=async()=>{try{const username=localStorage.getItem(\"username\");setUser(username);const response=await axios.get(`${apiUrl}/api/data`);setItems(response.data);const userItems=response.data.filter(item=>item.user===username);const driverList=[...new Set(response.data.map(item=>item.driver))];setDrivers(driverList);}catch(error){console.error(\"Ошибка при загрузке данных:\",error);}};fetchData();},[]);// Вычисляем текущий и предыдущий месяц\nconst currentMonth=dayjs().month();const previousMonth=dayjs().subtract(1,\"month\").month();// Фильтруем заявки за текущий и предыдущий месяцы\nconst currentMonthItems=items.filter(item=>dayjs(item.createdAt).month()===currentMonth);const previousMonthItems=items.filter(item=>dayjs(item.createdAt).month()===previousMonth);// Вычисляем сумму всех значений price и calcPay\nconst totalPrice=items.reduce((total,item)=>{const price=parseFloat(item.price)||0;return total+price;},0);const totalCalcPay=items.reduce((total,item)=>{const calcPay=parseFloat(item.calcPay)||0;return total+calcPay;},0);useEffect(()=>{if(selectedDriver){const ordersForSelectedDriver=items.filter(item=>item.driver===selectedDriver&&item.colorClass);setFilteredOrders(ordersForSelectedDriver);}else{setFilteredOrders([]);}},[selectedDriver,items]);const handleDriverChange=e=>{setSelectedDriver(e.target.value);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"button\",{children:\"Go to Home\"})}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"\\u041F\\u0440\\u043E\\u0444\\u0438\\u043B\\u044C: \",user]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041E\\u0431\\u0449\\u0435\\u0435 \\u043A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432: \",items.length]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041E\\u0431\\u0449\\u0435\\u0435 \\u043A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0441\\u0443\\u043C\\u043C \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432: \",totalPrice]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041E\\u0431\\u0449\\u0435\\u0435 \\u0437\\u043D\\u0430\\u0447\\u0435\\u043D\\u0438\\u0435 \\u043E\\u043F\\u043B\\u0430\\u0442\\u044B: \",totalCalcPay]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0437\\u0430\\u044F\\u0432\\u043E\\u043A \\u0437\\u0430 \\u0442\\u0435\\u043A\\u0443\\u0449\\u0438\\u0439 \\u043C\\u0435\\u0441\\u044F\\u0446: \",currentMonthItems.length]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0437\\u0430\\u044F\\u0432\\u043E\\u043A \\u0437\\u0430 \\u043F\\u0440\\u0435\\u0434\\u044B\\u0434\\u0443\\u0449\\u0438\\u0439 \\u043C\\u0435\\u0441\\u044F\\u0446: \",previousMonthItems.length]}),/*#__PURE__*/_jsxs(\"div\",{className:\"orderZa\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0417\\u0430\\u043A\\u0430\\u0437\\u0447\\u0438\\u043A\\u0430:\"}),/*#__PURE__*/_jsxs(\"select\",{onChange:handleDriverChange,value:selectedDriver,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0417\\u0430\\u043A\\u0430\\u0437\\u0447\\u0438\\u043A\\u0430\"}),drivers.map((driver,index)=>/*#__PURE__*/_jsx(\"option\",{value:driver,children:driver},index))]})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"arenda\",children:\"\\u0418\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044F \\u043E\\u0431 \\u0441\\u0443\\u0431 \\u0410\\u0440\\u0435\\u043D\\u0434\\u0435\"}),filteredOrders.length>0?/*#__PURE__*/_jsx(\"ul\",{children:filteredOrders.map(order=>/*#__PURE__*/_jsxs(\"li\",{className:\"order\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0414\\u0430\\u0442\\u0430: \",/*#__PURE__*/_jsx(\"span\",{children:dayjs(order.date).format(\"DD.MM.YYYY\")})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0417\\u0430\\u043A\\u0430\\u0437\\u0447\\u0438\\u043A: \",/*#__PURE__*/_jsx(\"span\",{children:order.customer})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2116 \\u041F\\u0443\\u0442\\u0435\\u0432\\u043E\\u0433\\u043E: \",/*#__PURE__*/_jsx(\"span\",{children:order.vehicleNumber})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0427\\u0430\\u0441\\u044B: \",/*#__PURE__*/_jsx(\"span\",{children:order.hours})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0436\\u0434\\u0435\\u043D\\u0438\\u0435:\",\" \",/*#__PURE__*/_jsx(\"span\",{children:order.isTrue?\"Подтверждено\":\"Не подтверждено\"})]})]},order._id))}):/*#__PURE__*/_jsx(\"p\",{children:\"\\u041D\\u0435\\u0442 \\u0437\\u0430\\u043A\\u0430\\u0437\\u043E\\u0432 \\u0434\\u043B\\u044F \\u0432\\u044B\\u0431\\u0440\\u0430\\u043D\\u043D\\u043E\\u0433\\u043E \\u0432\\u043E\\u0434\\u0438\\u0442\\u0435\\u043B\\u044F \\u0438\\u043B\\u0438 \\u0437\\u0430\\u043F\\u0438\\u0441\\u0438 \\u043D\\u0435 \\u0441\\u043E\\u0434\\u0435\\u0440\\u0436\\u0430\\u0442 `\\u0421\\u0443\\u0431 \\u0410\\u0440\\u0435\\u043D\\u0434\\u0443`.\"})]});};export default Profile;","map":{"version":3,"names":["React","useState","useEffect","Link","axios","dayjs","jsx","_jsx","jsxs","_jsxs","Profile","items","setItems","drivers","setDrivers","selectedDriver","setSelectedDriver","filteredOrders","setFilteredOrders","user","setUser","apiUrl","fetchData","username","localStorage","getItem","response","get","data","userItems","filter","item","driverList","Set","map","driver","error","console","currentMonth","month","previousMonth","subtract","currentMonthItems","createdAt","previousMonthItems","totalPrice","reduce","total","price","parseFloat","totalCalcPay","calcPay","ordersForSelectedDriver","colorClass","handleDriverChange","e","target","value","children","to","length","className","onChange","index","order","date","format","customer","vehicleNumber","hours","isTrue","_id"],"sources":["C:/Users/USER/Downloads/BamSheet/my-spreadsheet-app/bamapp/src/components/Profile.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport dayjs from \"dayjs\";\r\n\r\nconst Profile = () => {\r\n  const [items, setItems] = useState([]);\r\n  const [drivers, setDrivers] = useState([]);\r\n  const [selectedDriver, setSelectedDriver] = useState(\"\");\r\n  const [filteredOrders, setFilteredOrders] = useState([]);\r\n  const [user, setUser] = useState(null);\r\n\r\n  const apiUrl = \"https://bam-app-489c6c1370a9.herokuapp.com\";\r\n\r\n  // Получение всех данных с сервера\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const username = localStorage.getItem(\"username\");\r\n        setUser(username);\r\n        const response = await axios.get(`${apiUrl}/api/data`);\r\n        setItems(response.data);\r\n        const userItems = response.data.filter(\r\n          (item) => item.user === username\r\n        );\r\n        const driverList = [\r\n          ...new Set(response.data.map((item) => item.driver)),\r\n        ];\r\n        setDrivers(driverList);\r\n      } catch (error) {\r\n        console.error(\"Ошибка при загрузке данных:\", error);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n  // Вычисляем текущий и предыдущий месяц\r\n  const currentMonth = dayjs().month();\r\n  const previousMonth = dayjs().subtract(1, \"month\").month();\r\n\r\n  // Фильтруем заявки за текущий и предыдущий месяцы\r\n  const currentMonthItems = items.filter(\r\n    (item) => dayjs(item.createdAt).month() === currentMonth\r\n  );\r\n  const previousMonthItems = items.filter(\r\n    (item) => dayjs(item.createdAt).month() === previousMonth\r\n  );\r\n\r\n  // Вычисляем сумму всех значений price и calcPay\r\n  const totalPrice = items.reduce((total, item) => {\r\n    const price = parseFloat(item.price) || 0;\r\n    return total + price;\r\n  }, 0);\r\n\r\n  const totalCalcPay = items.reduce((total, item) => {\r\n    const calcPay = parseFloat(item.calcPay) || 0;\r\n    return total + calcPay;\r\n  }, 0);\r\n  useEffect(() => {\r\n    if (selectedDriver) {\r\n      const ordersForSelectedDriver = items.filter(\r\n        (item) => item.driver === selectedDriver && item.colorClass\r\n      );\r\n      setFilteredOrders(ordersForSelectedDriver);\r\n    } else {\r\n      setFilteredOrders([]);\r\n    }\r\n  }, [selectedDriver, items]);\r\n\r\n  const handleDriverChange = (e) => {\r\n    setSelectedDriver(e.target.value);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <Link to=\"/\">\r\n        <button>Go to Home</button>\r\n      </Link>\r\n      <h1>Профиль: {user}</h1>\r\n\r\n      <p>Общее количество заказов: {items.length}</p>\r\n      <p>Общее количество сумм заказов: {totalPrice}</p>\r\n      <p>Общее значение оплаты: {totalCalcPay}</p>\r\n      <p>Количество заявок за текущий месяц: {currentMonthItems.length}</p>\r\n      <p>Количество заявок за предыдущий месяц: {previousMonthItems.length}</p>\r\n      <div className=\"orderZa\">\r\n        <h2>Выберите Заказчика:</h2>\r\n        <select onChange={handleDriverChange} value={selectedDriver}>\r\n          <option value=\"\">Выберите Заказчика</option>\r\n          {drivers.map((driver, index) => (\r\n            <option key={index} value={driver}>\r\n              {driver}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n      <h2 className=\"arenda\">Информация об суб Аренде</h2>\r\n      {filteredOrders.length > 0 ? (\r\n        <ul>\r\n          {filteredOrders.map((order) => (\r\n            <li key={order._id} className=\"order\">\r\n              <p>\r\n                Дата: <span>{dayjs(order.date).format(\"DD.MM.YYYY\")}</span>\r\n              </p>\r\n              <p>\r\n                Заказчик: <span>{order.customer}</span>\r\n              </p>\r\n              <p>\r\n                № Путевого: <span>{order.vehicleNumber}</span>\r\n              </p>\r\n              <p>\r\n                Часы: <span>{order.hours}</span>\r\n              </p>\r\n              <p>\r\n                Подтверждение:{\" \"}\r\n                <span>{order.isTrue ? \"Подтверждено\" : \"Не подтверждено\"}</span>\r\n              </p>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      ) : (\r\n        <p>\r\n          Нет заказов для выбранного водителя или записи не содержат `Суб\r\n          Аренду`.\r\n        </p>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Profile;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}